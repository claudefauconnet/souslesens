<!-- *******************************************************************************
 * SOUSLESENS LICENSE************************
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2016-2017 Claude Fauconnet claude.fauconnet@neuf.fr
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 ******************************************************************************-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="ISO-8859-1">
    <title>souslesens</title>


    <!--  <link rel="stylesheet" type="text/css" title="Design"
            href="../common/js/jquery/theme_humanity/jquery-ui.min.css"/>-->
    <link rel="stylesheet" media="screen" type="text/css" title="Design" href="../common/js/jquery/jquery-ui.min.css"/>


    <link rel="stylesheet" href="../common/js/jsTree/themes/default/style.min.css"/>

    <!--<link rel="stylesheet" href="js/Tree/themes/default/style.min.css"/>-->
    <!--<link rel="stylesheet" type="text/css"
        href="../common/js/others/jquery.handsontable.full.min.css" />-->

    <link rel="stylesheet" type="text/css" href="css/d3tree.css"/>
    <link rel="stylesheet" type="text/css" href="css/index.css"/>
    <link rel="stylesheet" type="text/css" href="css/treemap.css"/>

    <link rel="stylesheet" type="text/css" href="css/cards.css"/>

    <script src="../common/js/jquery/jquery.min.js"></script>
    <script src="../common/js/jquery/jquery-ui.min.js"></script>

    <script src="../common/js/neo4jDataModel.js"></script>

    <script src="../common/js/d3/d3.js"></script>
    <script src="../../common/js/d3/d3-colorLegend.js"></script>
    <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->
    <!--<script src="https://d3js.org/d3.v4.min.js"></script>-->

    <script src="js/globalVars.js"></script>
    <script src="resources/params.js"></script>

    <script src="../common/js/common.js"></script>

    <script src="js/customizeUI.js"></script>
    <script src="js/toutlesensController.js"></script>
    <script src="js/toutlesensData.js"></script>
    <script src="js/toutlesensDialogsController.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/paint.js"></script>
    <script src="js/mainMenu.js"></script>
    <script src="js/traversalMenu.js"></script>
    <script src="js/modifyData.js"></script>

    <!--
    <script src="js//externalRessourcesCommon.js"></script>
    <script src="js//externalRessourcesDbPedia.js"></script>
    <script src="js//externalRessourcesBNF.js"></script>
    -->

    <script src="js/d3common.js"></script>
    <script src="js/d3legend.js"></script>

    <script src="js/d3flower.js"></script>

    <script src="js/d3simpleForce.js"></script>
    <script src="js/d3simpleForceLight.js"></script>
    <script src="js/souslesensForcelayout.js"></script>
    <script src="js/d3simpleForceBulk.js"></script>
    <script src="js/d3treemap.js"></script>
    <script src="js/d3forceCollapseClass.js"></script>
    <script src="js/d3tree.js"></script>

    <script src="js/cards.js"></script>


    <script src="../common/js/util.js"></script>


    <!--<script src="js//d3.forceGraphClass.js"></script>
    <script src="js//d3.dndTreeClass.js"></script>
    <script src="js//d3.modifiableGraph.js"></script>
    <script src="js//d3.forceCollapseClass.js"></script>
    <script src="js//d3.gantt.js"></script>
    <script src="js//gant-chart-d3v2.js"></script>
    <script type="text/javascript" src="js//gant-chart-d3v2.js"></script>
    <script type="text/javascript" src="js//d3.gantt.js"></script>

    <script src="../admin/js//graphD3.js"></script>
     <script src="js/advancedDisplay.js"></script>
    -->
    <script src="js/textOutputs.js"></script>


    <script src="js/.js"></script>
    <script src="js/selection.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/graphTraversalQueries.js"></script>

    <script src="./js/schema.js"></script>
    <script src="../common/js/jsTree/jstree.min.js"></script>
    <!--<script src="./js/jsTree/treeController.js"></script>-->
    <script src="./js/infosGenericDisplay.js"></script>

    <script src="./js/neoToMongo.js"></script>
    <script src="../common/js/devisuProxy.js"></script>

    <script src="js/advancedSearch.js"></script>
    <script src="../common/js/others/tableFlip.js"></script>
    <!--<script src="js//jit-yc.js"></script>
    <link rel="stylesheet" type="text/css"
        href="../common/js/others/jquery.datatables.min.css" />
    <script type="text/javascript"
        src="../common/js/others/jquery.datatables.min.js"></script>-->


    <script src="js/help.js"></script>
    <script src="js/lang.js"></script>
    <script src="resources/lang_FR.js"></script>
    <script src="resources/lang_EN.js"></script>
    <script src="js/functionalities.js"></script>


    <!-- test visjs------------------------------------------>
    <script src="js/visjs/visjs.js"></script>
    <script src="js/visjs/visJsGraph.js"></script>
    <link rel="stylesheet" type="text/css" href="js/visjs/vis-network.min.css.js"/>
    <!-- test visjs---------------------------------------->
    <style>
        #treeContainer {
            width: 500px;
            overflow: auto;

        }

        #nodeInfosDiv {
        / / display: flex;
            justify-content: center;
            align-items: center;
        }

        #word, #nodesLabelsSelect {
            width: 130px;
        }

        #nodeInfosDiv, relationInfosDivWrapper {
            padding: 20px;
            border-width: 0px;
            border-color: #5f3f3f;
            border-style: groove;
            margin: 20px;

            overflow: auto;
            height: 500px;
            background-color: seashell;
            font-size: 14px;
            font-family: verdana, sans-serif;
            font-weight: normal;

        }

        #infosHeaderDiv {
            background-color: burlywood;
            font-size: 14px;
            font-weight: bold;
        }

        .objAttrInput, #newNodeName {

            width: 500px;

        }

        .displayIcon-selected {
            border-width: 5px;
            border-color: #666;
            border-color: #af9d09;

            border-style: inset;
        }

        .infoTitle {
            font-size: 14px;
            font-family: verdana, sans-serif;
            font-weight: bold;
        }

        #innerLegendDiv, #relInfoDiv {
            margin-left: 20px;
            font-size: 10px;
            font-family: verdana, sans-serif;
            font-weight: bold;
        }


    </style>

    <script>

        $(function () {

            queryParams = toutlesensController.getQueryParams(document.location.search);
            customizeUI.init();
            subGraph = queryParams.subGraph;
            functionalities.hideFunctionalities();
            lang.setLangage();


            var mode = queryParams.mode;
            if (mode == "write")
                Gparams.readOnly = false;

            $("#tabs").tabs();
            ///$("#advancedQueriesDiv").tabs(); see advancedSearch.js
            $(".fillScreenHeight").css("bottom", 600);


            for (var i = 0; i < Gparams.palette.length; i++) {
                /*	$("#colorTest").append("<div style='background-color:"+palette[i]+"'>"+palette[i]+"</div>");*/
            }
            $("body").click(function (e) {
                currentMousePosition = {
                    x: e.pageX,
                    y: e.pageY
                }

            });


            $("#graphDiv").click(function (e) {
                if (currentDisplayType = "VISJS-NETWORK")
                    return;
                var dat = e.target.__data__;
                if (!dat) {
                    toutlesensController.hidePopupMenu();
                    return;
                }
                if (dat.id == null || dat.id == "")
                    toutlesensController.hidePopupMenu();

            });



            totalWidth = $(window).width()-20;
            totalHeight = $(window).height()-20;

            $("body").height(totalHeight );

           rightPanelWidth=Math.round(totalWidth* Gparams.rightPanelTotalWidthRatio)
      //  toutlesensController.setResponsiveDimensions(rightPanelWidth); see customizeUI



            //   $("#nodeInfosDiv").height(totalHeight - 200).width(totalWidth - 650)












            $("#tabs-mainPanel").tabs(
                {
                    activate: function (event, ui) {


                        var index = ui.newTab.index();
                        if (index == 2) {//data
                            $("#mainButtons").css("visibility","hidden");
                        }
                        if (index == 1) {//list
                            toutlesensController.onTextVisButton('HTML');
                            $("#mainButtons").css("visibility","hidden");
                        }

                    }
                }
            );
            $("#tabs-controlPanel").tabs({

                activate: function (event, ui) {
                    var index = ui.newTab.index();
                    toutlesensController.onRadarLeftActivate(index);
                },
                create: function (event, ui) {


                }

            });


            $("#table_Graph").tabs();
            $("#linkNodesDivAccordion").accordion({
                heightStyle: "content"
            });


            $("#accordionModifyPanel").accordion();

            $("#accordionRepresentation").accordion({
                active: function (eee) {
                    return -1
                }
                ,

                beforeActivate: function (event, ui) {
                    var panel = ui.newPanel[0].id;

                    h = totalHeight / 2;
                    $(".accordionLeft .ui-accordion-content").height(h);
                },
                activate: function (event, ui) {

                    var panel = ui.newPanel[0].id;
                    $(".accordionLeft .ui-accordion-content").height($("#" + panel).height());


                }


            });

            $('#visJsSearchGraphButton').on('keypress', function (e) {
                if (e.which === 13) {
                    var expression = $("#visJsSearchGraphButton").val();
                    visjsGraph.findNode(expression, "blue", 15);
                }
            });


            filterDiv = "radarFiltersDiv";
            bcsTreeDiv = "#bcsTreeDiv";
            radarDiv = "#radarDiv";
            attrsIFrame = "#attrsIframe";


            if (Gparams.readOnly === true) {
                //   $("#li_modify").detach();
                $("#li_nodeDetails").detach();
                $("#li_neoQueries").detach();


            }


            $("#dialog").dialog({
                autoOpen: false,
                height: Gparams.bigDialogSize.h,
                width: Gparams.bigDialogSize.w,
                modal: true

            });


            $("#popupMenuNodeInfoDiv").mouseleave(function () {
                $(this).hide();
            });


            //  advancedSearch.init();

            var afterLoadModelTasks = [
                infoGenericDisplay.initLabels,
                customizeUI.customize,
                toutlesensController.afterGraphInit,
                statistics.initLabelsCurrentQueries,
              //  advancedSearch.patternInitLabels,
               // advancedSearch.patternInitRelTypes,
                // advancedDisplay.initDecorationDiv,
                functionalities.initFunctionalities

            ]

            Schema.load(subGraph, function (err, schema) {
                if (err)
                    return setMessage("Error cannot load Schema");
                // play init UI methods after schema is loaded
                for (var i = 0; i < afterLoadModelTasks.length; i++) {
                    try {
                        afterLoadModelTasks[i](subGraph);
                    }
                    catch (err) {
                        console.log("" + i + "  " + err);
                    }
                }


                toutlesensController.appInitEnded = true;
                toutlesensController.appInitEnded = true;

            })


        })

        function onLabelActionSelect(select) {
            var value = $(select).val();
            if (value == "displayGraphForLabel") {
                currentDisplayType = "SIMPLE_FORCE_GRAPH";
                currentLabel = $("#nodeLabelSelect").val();
                currentObject = {};
                if (currentLabel != "")
                    toutlesensController.generateGraph(null, false);

            }

            if (value == "listNodes") {

                currentDisplayType = "FLOWER";

                currentLabel = null;//$("#nodeLabelSelect").val();


            }

        }

        function onLabelSelect(select) {
            var value = $(select).val();
            /*  if (value == "")
             $("#onLabelActionSelect").val("displayGraphForLabel");
             else
             $("#onLabelActionSelect").val("listNodes");*/
            var actionType = $("#onLabelActionSelect").val();
            if (actionType == "listNodes") {
                infoGenericDisplay.clearNodePropertiesDiv();
                // $("#treeHeader").css("visibility", "hidden");

                //  initUI();
                //  dbName = $("#dbName").val();

                if (value != "")
                    infoGenericDisplay.loadTreeFromNeoMatchQuery(value);
            }

            else if (actionType == "displayGraphForLabel") {
                currentLabel = value;
                currentDisplayType = "SIMPLE_FORCE_GRAPH";
                toutlesensController.generateGraph(null, false);

            }
        }


    </script>
</head>
<body>


<!--  ****************************************************right panel***************************-->


<div id="tabs-mainPanel">

    <ul id="tab_li_right">
        <li><a href="#graphTab"><span id='lang_28'><span
                id='lang_42'>Graphe</span></span></a></li>
        <li><a href="#textTab"><span id='lang_29'>Liste</span></a></li>

        <!--    <li id="li_nodeDetails"><a href="#nodeDetailsTab">Details </a></li>-->
        <li id="li_modify"><a href="#dataTab"><span id='lang_31'>Data</span></a></li>

    </ul>


    <!--  ****************************************************graph***************************-->
    <div id="graphTab">
        <div id="center">


            <div id="graphDiv"></div>

            <div id="popupMenuNodeInfoDiv" class="popupmenuDiv">
                <div id="popupMenuNodeInfo">//onblur="hidePopupMenu()" >
                </div>
            </div>



        </div>
    </div>


    <!--  ****************************************************textTab***************************-->
    <div id="textTab">
        <div id="textDivContainer">
            <table class="visButtonTable">
                <tr>
                    <td><input type="image" height="30px"
                               alt="<span id='lang_13'>liste</span>"
                               onclick="toutlesensController.onTextVisButton('HTML')" id="listOuput"
                               src="images/list.png"/></td>

                    <td><input type="image" height="30px" alt="table"
                               onclick="toutlesensController.onTextVisButton('CSV')" id="csvOutput"
                               src="images/table.png"/></td>
                    <td>

                        <button id="listDownloadButton" onclick="textOutputs.downloadTextOutput()">
                            <span id='lang_43'>telecharcher</span>
                        </button>

                    </td>
                    <!--     <td><input type="image" height="30px" alt="table"
                                    onclick="toutlesensDialogsController.showGanttDialog()" id="Gantt"
                                    src="images/gantt.png"/></td>
                         <td>-->
                </tr>
            </table>

            <br>
            <div id="textDiv"></div>
        </div>

    </div>


    <!--  ****************************************************modify***************************-->
    <div id="dataTab">
        <div id="infosDiv">
            <div id="infosHeaderDiv">
                &nbsp;&nbsp;<button onclick="infoGenericDisplay.saveNode()">Save</button>
                &nbsp;&nbsp;<button onclick="infoGenericDisplay.deleteNode()">Delete</button>
            </div>
            <div id="relInfosDivWrapper">
                Relation&nbsp;
                <span cclass="infoTitle" id="relationType"></span>
                <div id="relInfosDiv"></div>
            </div>

            <div id="nodeInfosDivWrapper">
                Node &nbsp;
                <span id="nodeLabel" class="infoTitle"></span>
            </div>
            <div id="nodeInfosDiv"></div>
        </div>
    </div>
</div>






<div id="mainButtons" >
 <!--   <input type="image" title="Data menu" height="40px" onclick="mainMenu.showDataMenu()" id="dataMenuButton"
           src="images/data.png"/>-->
    <input type="image" title="Graph menu" height="30px" onclick="mainMenu.showGraphDisplayMenu()"
           id="parametersMenuButton" src="images/parameters.png"/>
    <input type="image" title="Previous display" height="30px"
           onclick="toutlesensController.replayGraph('previous')" id="previousMenuButton"
           src="images/previous.png"/>
    <input type="image" title="Next display" height="30px" onclick="toutlesensController.replayGraph('next')"
           id="nextMenuButton" src="images/next.png"/>
    <img id="waitImg" src="images/waitAnimated.gif" width="50px"
         style="visibility: hidden;">
</div>





<div id="tabs-controlPanel">

    <ul>
        <li><a href="#searchDiv"><span id='lang_60'>Search  </span></a></li>
        <li><a href="#graphLegendDiv"><span id='lang_60'>Explore </span></a></li>
        <li><a href="#pathesDiv"><span id='lang_60'>Pathes </span></a></li>
        <li><a href="#specialQueriesDiv"><span id='lang_60'>Special </span></a></li>


        <li><a href="#rdfDiv"><span id='lang_179'>RDF</span></a></li>

        <!--  <li><a href="#attrsTab"><span id='lang_37'>Infos.</span></a></li>-->
        <!--  <li><a href="#selectionTab"><span id='lang_170'>Selection</span></a></li>-->
    </ul>



    <!--  ****************************************************noeudInitial***************************-->


    <div id="searchDiv">
        <div id="topPanel">
            <input type="hidden" value="500" id="limitResult">
            <table border="0">


                <tr>

                    <td colspan="2">
                        <br> Label <select id="nodesLabelsSelect"
                                           onchange="toutlesensController.onLabelSelect(this)"> </select>

                        <hr>
                        <span id='lang_1'>Node</span>
                        <input id="word"
                               onkeyup="toutlesensController.searchNodesUI('matchStr',null,null, infoGenericDisplay.loadSearchResultIntree);"
                               size="10"> <input type="image"
                                                 alt="<span id='lang_XX'>search</span>" height="20px"
                                                 onclick="advancedSearch.showDialog()"
                                                 id="searchButton"
                                                 src="images/search.png"/>


                       <br> <button id="createNodeButton" onclick="infoGenericDisplay.createNewRootNode()">
                            New node
                        </button>
                        <!-- <button  onclick="showAdvancedSearchDialog()">+</button>-->


                    </td>

                </tr>


                <tr>
                    <td colspan="2">


                        <div id="treeContainer">
                            <div id="genericTree"></div>
                        </div>

                    </td>


                </tr>


            </table>
        </div>
    </div>

    <div id="graphLegendDiv">
        <div id="paintDiv"></div>
        <!-- <div> Outline nodes<input id="visJsSearchGraphButton" style="visibility: hidden"></div>-->
        <div id="filtersDiv"></div>

        <div id="innerLegendDiv"></div>
        <div id="graphMessage" class="message"><br></div>
        <div id="relInfoDiv"></div>
    </div>

    <div id="pathesDiv">
    </div>
    <div id="specialQueriesDiv">
    </div>


    <!-- /*******************************************************RDF************************************************************/
     /*******************************************************RDF************************************************************/
     /*******************************************************RDF************************************************************/-->

    <div id="rdfDiv">
        <table>
            <tr>
                <td>
                    Word
                </td>

                <td>
                    <input id="rdfWordInput">
                </td>
            </tr>
            <tr>
                <td>
                    Relation
                </td>

                <td>
                    narrower <input type="checkbox" checked="checked" value="narrower"
                                    name="relationCBX"><br>
                    broader<input type="checkbox" value="broader" name="relationCBX"><br>
                    related <input type="checkbox" value="related" name="relationCBX"><br>
                    <!--  <select id="rdfRelationSelect">
                           <option>narrower</option>
                           <option>broader</option>
                           <option>related</option>

                       </select>-->
                </td>
            </tr>
            <tr>
                <td>
                    Store
                </td>

                <td>
                    <select id="rdfStoreSelect">
                        <option>BNF</option>
                        <option>DBPEDIA</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Langage
                </td>

                <td>
                    <select id="rdfLangageSelect">
                        <option>fr</option>
                        <option>en</option>
                    </select>
                </td>
            </tr>
            <td>
                Contains
            </td>

            <td>
                <select id="rdfContainsSelect">
                    <option>false</option>
                    <option>true</option>
                </select>
            </td>
            </tr>
            <td>
                <select id="rdfDisplaySelect">
                    <option>FLOWER</option>
                    <option>SIMPLE_FORCE_GRAPH</option>
                    <option>TREE</option>
                    <option>CARDS</option>
                </select>
            </td>
            </tr>
            <tr align="center">

                <td colspan="2" valign="center">
                    <button onclick="toutlesensController.searchRDF()"><span
                            id='lang_61'> Search RDF</span></button>

            </tr>


        </table>


    </div>

</div>


<div id="dialog" title="dialog"></div>


</body>
</html>