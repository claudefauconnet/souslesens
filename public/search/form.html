<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script src="../common/js/jquery/jquery.min.js"></script>
<script src="../common/js/common.js"></script>
<script src="../toutlesens/resources/params.js"></script>
<script src="./js/infosGenericMongo.js"></script>



<script>
    var callerId=null;
    var dbName;
    var collectionName;
    var Schema = {
        schema: {

            "properties":
                {
                    "coteBoite":
                        {
                            "type": "text"
                        }
                    ,
                    "coteSerie":
                        {
                            "type": "text"
                        }
                    ,
                    "coteSousSerie":
                        {
                            "type": "text"
                        }
                    ,
                    "confidentiel":
                        {
                            "type": "text"
                        }
                    ,
                    "titre":
                        {
                            "type": "text",
                            cols: 80
                        },
                    "auteur":
                        {
                            "type": "text",
                            cols: 80
                        }
                    ,
                    "commentaire":
                        {
                            "type": "text",
                            rows: 5,
                            cols: 80
                        }
                    ,
                    "anneeDebut":
                        {
                            "type": "text"

                        }
                    ,
                    "anneeFin":
                        {
                            "type": "text"
                        }
                    ,

                    "dateStr":
                        {
                            "type": "text"
                        }
                    ,
                    "destinataire":
                        {
                            "type": "text"
                        }
                    ,
                    "format":
                        {
                            "type": "text"
                        }
                    ,
                    "genre":
                        {
                            "type": "text"
                        }
                    ,
                    "lieu":
                        {
                            "type": "text"
                        }
                    ,
                    "nbFeuilles":
                        {
                            "type": "text"
                        }
                    ,
                    "source":
                        {
                            "type": "text"
                        }
                    ,

                },
            fieldsSelectValues: {
                "archive": {
                    "confidentiel": ["", "C"]
                }
            }
        },


    }


    $(function(){

            loadFormDataFromMongo("ATD", "archives","5a3d1b1dc3508e853c7eacbe")


    })


    function loadFormDataFromMongo(_dbName, _collectionName, id) {
        dbName=_dbName;
        collectionName=_collectionName;
        var payload = {

            find: 1,
            dbName: dbName,
            collectionName: collectionName,
            mongoQuery: {_id: id},
        }

        $.ajax({
            type: "POST",
            url: Gparams.mongoProxyUrl,
            data: payload,
            dataType: "json",
            success: function (data, textStatus, jqXHR) {
                if (data.length == 0) {
                    return;

                }
                var attrObject = Schema.schema.properties;
                infosGenericMongo.setAttributesValue("archive",  data[0],attrObject);
                infosGenericMongo.drawAttributes(attrObject, "genericFormDiv");


            },
            error: function (err) {
                console.log(err);
            }
        })
    }

    function save(){
        var obj={}
        var obj=  infosGenericMongo.setModifiedValues(obj,".objAttrInput")
        infosGenericMongo.save(dbName, collectionName, obj, true, {})
    }





</script>

<body>
<div id="genericFormDiv">


</div>
<button onclick='save()'>Save</button>

</body>
</html>